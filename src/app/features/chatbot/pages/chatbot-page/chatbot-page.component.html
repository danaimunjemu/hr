<div class="page-header">
  <div>
    <p class="kicker">HR Support Workspace</p>
    <h1>NerdSmart AI Assistant</h1>
    <p class="subtitle">Ask policy questions, draft responses, and get guided HR help in one thread.</p>
  </div>
  <span class="assistant-status">Live assistant</span>
</div>

<div class="chatbot-layout">
  <nz-card class="chat-card" [nzBodyStyle]="{ padding: '0', display: 'flex', flexDirection: 'column', height: '100%' }">
    <div class="messages-container" #scrollContainer>
      <div class="starter-prompts" *ngIf="messages.length === 1 && !isLoading()">
        <p>Try one of these to get started:</p>
        <button
          type="button"
          class="prompt-chip"
          *ngFor="let prompt of starterPrompts"
          (click)="useStarterPrompt(prompt)">
          {{ prompt }}
        </button>
      </div>

      <div *ngFor="let msg of messages" class="message-row" [ngClass]="{'user-row': msg.sender === 'user', 'bot-row': msg.sender === 'bot'}">
        <nz-avatar
          class="message-avatar"
          [nzIcon]="msg.sender === 'bot' ? 'robot' : undefined"
          [nzText]="msg.sender === 'user' ? userInitials : undefined"
          [style.background]="msg.sender === 'bot' ? '#1f2937' : '#fde3cf'"
          [style.color]="msg.sender === 'bot' ? '#f9fafb' : '#f56a00'">
        </nz-avatar>

        <div class="message-content">
          <div class="message-bubble">
            <markdown [data]="msg.content"></markdown>
          </div>
          <span class="message-time">{{ msg.timestamp | date:'shortTime' }}</span>
        </div>
      </div>

      <div *ngIf="isLoading()" class="message-row bot-row">
        <nz-avatar class="message-avatar" nzIcon="robot" [style.background]="'#1f2937'" [style.color]="'#f9fafb'"></nz-avatar>
        <div class="message-content">
          <div class="message-bubble loading-bubble">
            <span nz-icon nzType="loading" nzTheme="outline"></span> Typing...
          </div>
        </div>
      </div>
    </div>

    <div class="input-area">
      <p class="input-label">Replying as {{ userDisplayName }}</p>
      <nz-input-group [nzSuffix]="suffixButton" nzSize="large">
        <input
          type="text"
          nz-input
          placeholder="Type a message..."
          [(ngModel)]="userInput"
          (keyup.enter)="sendMessage()"
          [disabled]="isLoading()" />
      </nz-input-group>
      <ng-template #suffixButton>
        <button nz-button nzType="primary" nzSize="large" (click)="sendMessage()" [disabled]="!userInput.trim() || isLoading()">
          <span nz-icon nzType="send" nzTheme="outline"></span> Send
        </button>
      </ng-template>
    </div>
  </nz-card>
</div>
