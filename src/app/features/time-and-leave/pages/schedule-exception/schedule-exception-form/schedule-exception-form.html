<nz-page-header
  [nzGhost]="false"
  [nzBackIcon]="'arrow-left'"
  (nzBack)="onCancel()"
  [nzTitle]="isEditMode ? 'Edit Exception' : 'New Exception'"
>
</nz-page-header>

<nz-card [nzLoading]="loading">
  <form nz-form [formGroup]="form" (ngSubmit)="onSubmit()" nzLayout="vertical">
    
    <nz-form-item>
      <nz-form-label [nzSpan]="24" nzRequired nzFor="targetType">Target Type</nz-form-label>
      <nz-form-control [nzSpan]="24" nzErrorTip="Required">
        <nz-radio-group formControlName="targetType">
          <label nz-radio nzValue="EMPLOYEE">Individual Employee</label>
          <label nz-radio nzValue="GROUP">Employee Group</label>
        </nz-radio-group>
      </nz-form-control>
    </nz-form-item>

    <div *ngIf="form.get('targetType')?.value === 'EMPLOYEE'">
      <nz-form-item>
        <nz-form-label [nzSpan]="24" nzRequired nzFor="employee">Employee</nz-form-label>
        <nz-form-control [nzSpan]="24" nzErrorTip="Please select an employee">
          <nz-select formControlName="employee" [compareWith]="compareFn" nzPlaceHolder="Select employee" nzShowSearch>
            <nz-option *ngFor="let emp of employees" [nzValue]="emp" [nzLabel]="emp.firstName + ' ' + emp.lastName"></nz-option>
          </nz-select>
        </nz-form-control>
      </nz-form-item>
    </div>

    <div *ngIf="form.get('targetType')?.value === 'GROUP'">
      <nz-form-item>
        <nz-form-label [nzSpan]="24" nzRequired nzFor="employeeGroup">Employee Group</nz-form-label>
        <nz-form-control [nzSpan]="24" nzErrorTip="Please select a group">
          <nz-select formControlName="employeeGroup" [compareWith]="compareFn" nzPlaceHolder="Select group">
            <nz-option *ngFor="let group of employeeGroups" [nzValue]="group" [nzLabel]="group.name"></nz-option>
          </nz-select>
        </nz-form-control>
      </nz-form-item>
    </div>

    <div nz-row [nzGutter]="24">
      <div nz-col [nzSpan]="12">
        <nz-form-item>
          <nz-form-label [nzSpan]="24" nzRequired nzFor="exceptionDate">Exception Date</nz-form-label>
          <nz-form-control [nzSpan]="24" nzErrorTip="Required">
            <nz-date-picker formControlName="exceptionDate" style="width: 100%"></nz-date-picker>
          </nz-form-control>
        </nz-form-item>
      </div>
      <div nz-col [nzSpan]="12">
        <nz-form-item>
          <nz-form-label [nzSpan]="24" nzRequired nzFor="offDay">Exception Type</nz-form-label>
          <nz-form-control [nzSpan]="24">
            <nz-switch formControlName="offDay" nzCheckedChildren="Off Day" nzUnCheckedChildren="Shift Override"></nz-switch>
          </nz-form-control>
        </nz-form-item>
      </div>
    </div>

    <div *ngIf="!form.get('offDay')?.value">
      <nz-form-item>
        <nz-form-label [nzSpan]="24" nzRequired nzFor="shiftDefinition">Override Shift</nz-form-label>
        <nz-form-control [nzSpan]="24" nzErrorTip="Please select a shift">
          <nz-select formControlName="shiftDefinition" [compareWith]="compareFn" nzPlaceHolder="Select override shift">
            <nz-option *ngFor="let shift of shiftDefinitions" [nzValue]="shift" [nzLabel]="shift.name"></nz-option>
          </nz-select>
        </nz-form-control>
      </nz-form-item>
    </div>

    <div class="flex justify-end gap-4 mt-6">
      <button nz-button type="button" (click)="onCancel()">Cancel</button>
      <button nz-button nzType="primary" [nzLoading]="submitting">
        {{ isEditMode ? 'Update' : 'Create' }}
      </button>
    </div>
  </form>
</nz-card>
