<div class="page-header">
    <div class="header-title">
        <button nz-button nzType="link" [routerLink]="['/app/recruitment/job-vacancies']">
            <span nz-icon nzType="arrow-left"></span>
            Back to List
        </button>
        <h1>Vacancy Details: {{ vacancy()?.position?.name }}</h1>
    </div>
    <div class="header-actions">
        <nz-space>
            <button *ngIf="canApproveHod()" nz-button nzType="primary" (click)="approveHod()">
                <span nz-icon nzType="check"></span>
                Approve (HOD)
            </button>
            <button *ngIf="canApproveHr()" nz-button nzType="primary" (click)="approveHr()">
                <span nz-icon nzType="check"></span>
                Approve (HR)
            </button>
            <button *ngIf="canFulfill()" nz-button nzType="primary" (click)="fulfill()">
                <span nz-icon nzType="check-circle"></span>
                Fulfill
            </button>
            <button nz-button nzType="default" [routerLink]="['edit']">
                <span nz-icon nzType="edit"></span>
                Edit
            </button>
        </nz-space>
    </div>
</div>

<nz-spin [nzSpinning]="loading()">
    <div *ngIf="vacancy() as v" nz-row [nzGutter]="16">
        <!-- Main Content -->
        <div nz-col [nzSpan]="16">
            <nz-card nzTitle="General Information">
                <nz-descriptions [nzColumn]="2" nzLayout="vertical">
                    <nz-descriptions-item nzTitle="Position">{{ v.position.name }} ({{ v.position.code
                        }})</nz-descriptions-item>
                    <nz-descriptions-item nzTitle="Organisational Unit">{{ v.organisationalUnit.name
                        }}</nz-descriptions-item>
                    <nz-descriptions-item nzTitle="Hiring Manager">{{ v.hiringManager.firstName }} {{
                        v.hiringManager.lastName }}</nz-descriptions-item>
                    <nz-descriptions-item nzTitle="Status">
                        <nz-tag [nzColor]="getStatusColor(v.status)">{{ v.status }}</nz-tag>
                    </nz-descriptions-item>
                    <nz-descriptions-item nzTitle="Job Posting Type">{{ v.jobPostingType }}</nz-descriptions-item>
                    <nz-descriptions-item nzTitle="Internal Opportunity">
                        <nz-tag [nzColor]="v.internalOpportunity ? 'green' : 'orange'">
                            {{ v.internalOpportunity ? 'Yes' : 'No' }}
                        </nz-tag>
                    </nz-descriptions-item>
                    <nz-descriptions-item nzTitle="Positions Required">{{ v.numberOfPositions }}</nz-descriptions-item>
                    <nz-descriptions-item nzTitle="Positions Filled">{{ v.positionsFilled }}</nz-descriptions-item>
                </nz-descriptions>

                <nz-divider></nz-divider>

                <nz-descriptions [nzColumn]="1" nzLayout="vertical">
                    <nz-descriptions-item nzTitle="Motivation / Justification">
                        <div class="motivation-text">{{ v.motivation }}</div>
                    </nz-descriptions-item>
                </nz-descriptions>
            </nz-card>

            <nz-card nzTitle="Target Dates" class="mt-4">
                <nz-descriptions [nzColumn]="3">
                    <nz-descriptions-item nzTitle="Requested">{{ v.requestedDate | date:'mediumDate'
                        }}</nz-descriptions-item>
                    <nz-descriptions-item nzTitle="Start Date">{{ v.startDate | date:'mediumDate'
                        }}</nz-descriptions-item>
                    <nz-descriptions-item nzTitle="Target Start">{{ v.targetStartDate | date:'mediumDate'
                        }}</nz-descriptions-item>
                </nz-descriptions>
            </nz-card>
        </div>

        <!-- Sidebar / Workflow -->
        <div nz-col [nzSpan]="8">
            <nz-card nzTitle="Approval Workflow">
                <nz-timeline>
                    <nz-timeline-item [nzColor]="getStatusColor(v.headOfDepartmentApprovalStatus)">
                        <div class="font-semibold">HOD Approval</div>
                        <div>Status: <nz-tag [nzColor]="getStatusColor(v.headOfDepartmentApprovalStatus)">{{
                                v.headOfDepartmentApprovalStatus }}</nz-tag></div>
                        <div class="text-xs text-gray-500" *ngIf="v.headOfDepartmentApprovalComment">Comment: {{
                            v.headOfDepartmentApprovalComment }}</div>
                    </nz-timeline-item>

                    <nz-timeline-item [nzColor]="getStatusColor(v.hrManagerApprovalStatus)">
                        <div class="font-semibold">HR Approval</div>
                        <div>Status: <nz-tag [nzColor]="getStatusColor(v.hrManagerApprovalStatus)">{{
                                v.hrManagerApprovalStatus }}</nz-tag></div>
                        <div class="text-xs text-gray-500" *ngIf="v.hrManagerApprovalComment">Comment: {{
                            v.hrManagerApprovalComment }}</div>
                    </nz-timeline-item>

                    <nz-timeline-item
                        [nzColor]="v.status === 'APPROVED' ? 'green' : (v.status === 'DECLINED' ? 'red' : 'gray')">
                        <div class="font-semibold">Workflow Completion</div>
                        <div>Final Status: <nz-tag [nzColor]="getStatusColor(v.status)">{{ v.status }}</nz-tag></div>
                    </nz-timeline-item>
                </nz-timeline>
            </nz-card>

            <nz-card nzTitle="Key Stakeholders" class="mt-4">
                <div class="stakeholder-item">
                    <label>Head of Department</label>
                    <div>{{ v.headOfDepartment.firstName }} {{ v.headOfDepartment.lastName }}</div>
                </div>
                <nz-divider class="my-2"></nz-divider>
                <div class="stakeholder-item">
                    <label>HR Manager</label>
                    <div>{{ v.hrManager.firstName }} {{ v.hrManager.lastName }}</div>
                </div>
            </nz-card>

            <nz-alert *ngIf="v.overrideBy" nzType="info" [nzMessage]="'Workflow Overridden'"
                [nzDescription]="'This vacancy was overridden by ' + v.overrideBy.firstName + ' ' + v.overrideBy.lastName"
                nzShowIcon class="mt-4"></nz-alert>
        </div>
    </div>
</nz-spin>